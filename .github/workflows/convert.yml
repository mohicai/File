name: Convert .list to .mrs

on:
  push:
    paths:
      - 'file/**/*.list'

jobs:
  convert:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install Mihomo
        run: |
          curl -L https://release-assets.githubusercontent.com/github-production-release-asset/369178935/fd69bff6-75cd-4b42-88c4-6404f4386da3?sp=r&sv=2018-11-09&sr=b&spr=https&se=2026-01-01T02%3A45%3A55Z&rscd=attachment%3B+filename%3Dmihomo-linux-amd64-v3-v1.19.18.gz&rsct=application%2Foctet-stream&skoid=96c2d410-5711-43a1-aedd-ab1947aa7ab0&sktid=398a6654-997b-47e9-b12b-9515b896b4de&skt=2026-01-01T01%3A45%3A34Z&ske=2026-01-01T02%3A45%3A55Z&sks=b&skv=2018-11-09&sig=JhpaCkFP4aDYB8KJhJ2yru57tdGB7OgWORDD77xg07M%3D&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmVsZWFzZS1hc3NldHMuZ2l0aHVidXNlcmNvbnRlbnQuY29tIiwia2V5Ijoia2V5MSIsImV4cCI6MTc2NzIzMzczNSwibmJmIjoxNzY3MjMxOTM1LCJwYXRoIjoicmVsZWFzZWFzc2V0cHJvZHVjdGlvbi5ibG9iLmNvcmUud2luZG93cy5uZXQifQ.bc7ifOciK6jpff6Xi-_QTv8WgxbZtj-xlKFbUD8s5U8&response-content-disposition=attachment%3B%20filename%3Dmihomo-linux-amd64-v3-v1.19.18.gz&response-content-type=application%2Foctet-stream -o mihomo.gz
          gzip -d mihomo.gz
          chmod +x mihomo
          sudo mv mihomo /usr/local/bin/

      - name: Convert .list files
        run: |
          for f in $(find . -name "*.list"); do
            base="${f%.list}"
            echo "Converting $f -> ${base}.mrs"
            mihomo convert ruleset --input "$f" --output "${base}.mrs" --type domain
          done

      - name: Commit results
        run: |
          git config --global user.name "workflow-bot"
          git config --global user.email "bot@example.com"
          git add *.mrs
          git commit -m "Auto convert .list to .mrs"
          git push